#for a virtuabox test environment use:
# install guest additions...before installing you have to get linux src code in order to work
sudo apt-get install build-essential linux-headers-`uname -r`

#install booking calendar on ubuntu hardy in a virtual box environment...
#change hostname to b110-webserver (dont need this if you want to deploy on b110-websrv)
>sudo vi /etc/hostname
#change hostname to b110-webserver (dont need this if want to deploy on b110-websrv)
sudo vi /etc/hosts
# update sys
> sudo apt-get update
> sudo apt-get upgrade
#install setup tools and pip
sudo apt-get install python-setuptools python-dev build-essential mysql-server python-mysqldb python-ldap
sudo easy_install pip
sudo pip install --upgrade virtualenv
sudo pip install django
sudo apt-get install apache2-threaded-dev 
download  latest http://code.google.com/p/modwsgi/
#e.g.
wget http://modwsgi.googlecode.com/files/mod_wsgi-3.3.tar.gz
tar xzf mod_wsgi-2.6.tar.gz
cd mod_wsgi-3.3
./configure --with-python=/usr/bin/python2.5
make
sudo make install
sudo emacs /etc/apache2/mods-available/wsgi.load 
#put in the following line in that file:
LoadModule wsgi_module /usr/lib/apache2/modules/mod_wsgi.so
#save and exit
>sudo a2enmod wsgi
>sudo mkdir -p /var/www
>cd /var/www
mkdir django
cd django
mkdir django_projects
mkdir django_templates
mkdir media
cd django_projects
sudo django-admin.py startproject bookingCal
#now create an empty wsgi booking cal project
mkdir -p  bookingCal/apache
sudo nano bookingCal/apache/django.wsgi
-----
import os
import sys
 
path = '/var/www/django/django_projects'
if path not in sys.path:
    sys.path.insert(0, '/var/www/django/django_projects')
 
os.environ['DJANGO_SETTINGS_MODULE'] = 'bookingCal.settings'
 
import django.core.handlers.wsgi
application = django.core.handlers.wsgi.WSGIHandler()
-----

sudo nano /etc/apache2/sites-available/bookingCal

#please change server name e.g. on  b110-websrv use "<VirtualHost b110-websrv:80>"
-----
Listen 8080
NameVirtualHost *:8080
<VirtualHost *:8080>

    ServerName b110-websrv
    DocumentRoot /var/www/django/django_projects/bookingCal

    <Directory /var/www/django/django_projects/bookingCal>
        Order allow,deny
        Allow from all
    </Directory>

    WSGIDaemonProcess b110-websrv processes=2 threads=15 display-name=%{GROUP}
    WSGIProcessGroup b110-websrv

    WSGIScriptAlias / /var/www/django/django_projects/bookingCal/apache/django.wsgi

</VirtualHost>


-----
sudo a2ensite bookingCal
sudo /etc/init.d/apache2 reload
cd /var/www/django/django_projects/bookingCal
python manage.py runserver 0:8080
#test in webbrowser: http://0:8080  or http://b110-websrv:8080
ctrl+c django server
#in /var/www/django/django_projects/bookingCal make a backup of all old files, do a :
for FILE in *.py; do mv $FILE $FILE.old; done

#now copy bookingcal stuff, go to temp or root dir
cd 
svn checkout http://b110-devserver/svn/bookingCalPhyton
cd bookingCalPython
sudo cp *.py /var/www/django/django_projects/bookingCal
sudo cp -r ecalendar static templates /var/www/django/django_projects/bookingCal   
sudo touch /var/www/django/info.log
sudo chmod 777 /var/www/django/info.log
# i dont know yet if this is necessary : django-admin.py syncdb
#maybe now you need to copy over the websrv db etc.



#Main sources for this instruction:
#http://blog.stannard.net.au/2010/12/11/installing-django-with-apache-and-mod_wsgi-on-ubuntu-10-04/
#http://grok.zope.org/documentation/tutorial/installing-and-setting-up-grok-under-mod-wsgi/installing-and-configuring-mod-wsgi
#http://www.saltycrane.com/blog/2010/02/how-install-pip-ubuntu/
# some forum threads and newsgroup entries

